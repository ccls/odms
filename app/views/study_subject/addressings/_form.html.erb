<% javascripts('edit_addressing') %>
<% stylesheets(:addressing_edit) %>

<div class='control'><div class='control_row'>
<h3><%= ( @addressing.new_record? ) ? 'New' : 'Edit' %> Address</h3>
<div><%= link_to( 'Cancel', study_subject_contacts_path( @study_subject ),
	:class => 'button' ) %>&nbsp;<%= f.submit 'Save' %></div>
</div></div>

<%= f.error_messages %>

<div class='fields_for_address'>
<% @addressing.build_address if @addressing.address.nil? %>
<%= f.fields_for :address do |address_field| %>
<%#= address_field.wrapped_collection_select :address_type_id, 
	AddressType.all, :id, :key, :include_blank => true, :label_text => 'Type' %>
<%= address_field.wrapped_select :address_type, 
	@addressing.address.address_types, :include_blank => true, :label_text => 'Type' %>

<%#

This selector will uniquely include the existing data source
even if it is NOT included in the normal/new list

-%>
<div class='source'>
<%= f.wrapped_collection_select :data_source_id, 
	([ f.object.try(:data_source) ] + DataSource.where(:key => %w(raf consent interview usps other birthdata) )).compact.uniq,
		:id, :to_s, :include_blank => true, :label_text => 'Source:' %>
<%= f.wrapped_text_field :other_data_source, 
	:label_text => 'Specify if other:' %>
</div><!-- class='source' -->
<hr/>

<%= address_field.wrapped_text_field :line_1 %>
<%= address_field.wrapped_text_field :unit, :label_text => 'Apt.' %>
<%= address_field.wrapped_text_field :line_2 %>
<div class='field_wrapper'>
<%= address_field.label :city, 'City, State Zip' -%>
<%= address_field.text_field :city %>
<%= address_field.select :state, State.abbreviations, 
	{ :include_blank => true }, :class => 'state' %>
<%= address_field.text_field :zip, :class => :zip %>
</div>
<%= address_field.wrapped_text_field :county %>
<%= address_field.wrapped_country_select :country %>
</div>

<hr/>

<div class='moved'>
<%= f.wrapped_yndk_select :current_address,
	:label_text => 'Current Address?' %>
<%= f.wrapped_check_box(:subject_moved,
	:label_text => 'check here if this change indicates the subject has moved (may create operational event if type is residence and current changed to no)') %>
</div><!-- class='moved' -->

<%= f.wrapped_yndk_select :address_at_diagnosis,
	:label_text => 'Address at diagnosis?' %>

<%= f.wrapped_text_area :notes, :class => 'autosize' %>

<% end %><%# f.fields_for :address do |address_field| %>
