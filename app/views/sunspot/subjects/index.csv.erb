<% require 'csv' -%>
<%# 
	adding :headers => true is supposed to set a flag in the file 
	somewhere marking it as having a header row, but I don't 
	think that it actually does.

	also, use a - with the ruby closing tag to avoid extra lines in csv file.
-%>
<%= %w( 
id
subject_type
vital_status
case_control_type
reference_date
sex
dob
died_on
phase
birth_year
).to_csv( :headers => true) -%>
<% @search.results.each do |result| %>
<%= [
result.id,
result.subject_type,
result.vital_status,
result.case_control_type,
mdy_or_nil( result.reference_date ),
result.sex,
mdy_or_nil( result.dob ),
mdy_or_nil( result.died_on ),
result.phase,
result.birth_year
].to_csv.html_safe -%>
<% end -%>
<%#

I added html_safe to stop any html encoding just in case

-%>
